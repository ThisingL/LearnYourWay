# 个性化与阅读等级调整（移动端采集）

目标：基于学习者的年级与兴趣，将原始文本改写到合适阅读等级，并用贴合兴趣的例子替换通用范例，保持学科范畴与关键概念不丢失。

## 任务清单
1. 画像收集（Flutter）：年级、兴趣标签（运动/音乐/食物等）
2. 阅读等级测度与控制（CEFR/年级词表、可读性指标）
3. 个性化改写提示词设计与安全边界
4. 事实一致性与术语守护（守护提示/规则模板）
5. 评测与自动化回归（防漂移）

## 实现与提示词

### 1) 画像收集（Flutter）
- 提示词：
  - “在 Flutter 创建 `ProfileForm`（`grade`、`interests[]`），保存至本地（`hive/sqflite`）并同步到后端 `profiles`；允许离线采集后重试同步。”
- 测试：
  - Widget 测试：表单校验；
  - integration_test：填写->提交->收到后端 200；离线->本地缓存->联网自动重试。

### 2) 阅读等级控制（服务端）
- 策略：
  - 目标年级的词汇表/句式规则；
  - 可读性指标（如 Flesch-Kincaid）；
  - 先生成再用校对器二次约束。
- 提示词：
  - “给定 `grade`，将文本重写到目标阅读等级；替换例子到兴趣领域，但保持学科范畴与关键概念不变。”
- 测试：
  - 词表命中率统计；
  - 可读性分数阈值；
  - 人工标注样例对比。

### 3) 守护提示与术语表
- 提示词：
  - “提供 `glossary` 与 `must-keep terms`，不允许被类比替换；不编造、不过度简化关键定义。”
- 测试：术语完整性正则检查；关键句式存在性校验。

### 4) 自动化评测
- 评分 Rubric：正确性、覆盖度、可读性、贴合兴趣度、长度控制。
- 提示词（自评分/交叉评分）：
  - “充当评测器，按 Rubric 为改写结果逐项打分并解释。”
- 测试：基准样例版本化，自动对比分数并设警戒阈值。

## 验收
- 3 种年级 × 3 种兴趣组合稳定达标；术语不丢失；
- 评测分数稳定，无明显漂移；
- 客户端离线上传与失败重试可用。

