# 个性化与阅读等级调整

目标：基于学习者的年级与兴趣，将原始文本改写到合适阅读等级，并用贴合兴趣的例子替换通用范例，保持学科范畴与关键概念不丢失。

## 任务清单
1. 画像接收（API）：年级、兴趣标签（运动/音乐/食物等）
2. 阅读等级测度与控制（CEFR/年级词表、可读性指标）
3. 个性化改写提示词设计与安全边界
4. 事实一致性与术语守护（守护提示/规则模板）
5. 评测与自动化回归（防漂移）

## 实现与提示词

### 1) 画像收集（API 接口）
- **接口设计**：
  - `POST /profiles`：创建/更新用户画像
  - 请求体：`{ userId, grade, interests[] }`
  - `GET /profiles/:userId`：查询画像
  
- **测试方式**：
```bash
# cURL 创建画像
curl -X POST http://localhost:8000/profiles \
  -H "Content-Type: application/json" \
  -d '{
    "userId": "demo_user",
    "grade": 5,
    "interests": ["足球", "科学实验", "恐龙"]
  }' | jq .

# 查询画像
curl http://localhost:8000/profiles/demo_user | jq .

# Postman Collection 中添加测试用例
```

### 2) 阅读等级控制（服务端）
- 策略：
  - 目标年级的词汇表/句式规则；
  - 可读性指标（如 Flesch-Kincaid）；
  - 先生成再用校对器二次约束。
- 提示词：
  - “给定 `grade`，将文本重写到目标阅读等级；替换例子到兴趣领域，但保持学科范畴与关键概念不变。”
- 测试：
  - 词表命中率统计；
  - 可读性分数阈值；
  - 人工标注样例对比。

### 3) 守护提示与术语表
- 提示词：
  - “提供 `glossary` 与 `must-keep terms`，不允许被类比替换；不编造、不过度简化关键定义。”
- 测试：术语完整性正则检查；关键句式存在性校验。

### 4) 自动化评测
- 评分 Rubric：正确性、覆盖度、可读性、贴合兴趣度、长度控制。
- 提示词（自评分/交叉评分）：
  - “充当评测器，按 Rubric 为改写结果逐项打分并解释。”
- 测试：基准样例版本化，自动对比分数并设警戒阈值。

## 验收
- 3 种年级 × 3 种兴趣组合稳定达标；术语不丢失；
- 评测分数稳定，无明显漂移；
- API 接口稳定，Swagger 文档完整；
- 提供测试用例集（Postman/Python 脚本）演示不同画像的改写效果。

