# 学习素材生成

目标：基于个性化后的基础文本，生成多种学习形式：沉浸式文本、章节测验、思维导图，通过 **结构化 JSON API** 返回，便于后续任何前端渲染。

## 任务清单
1. 模块化生成器接口（`generate(type, input, options)`）
2. 沉浸式文本生成器（含插图占位）
3. 章节测验生成器（多选/判断/简答，含参考答案与点评）
4. 思维导图生成器（节点/边 JSON）
5. 质量评测与去偏/去毒守护
6. API 响应格式与 Schema 校验

## 实现与提示词

### 1) 生成器接口
- 提示词：
  - “实现统一生成器接口，新增素材仅需新增一个 `strategy`。”
- 测试：不同 `type` 路由正确，异常类型抛错。

### 2) 沉浸式文本
- **接口设计**：
  - `POST /materials/immersive`：生成沉浸式文本
  - 请求：`{ chunkId, profileId }`
  - 响应：`{ sections: [{title, paragraphs[], images: [{placeholder, description}]}] }`
  
- **提示词**：
  - "将章节重写为分节的沉浸式文本，保留关键定义；为插图留出 `{{image:desc}}` 占位；输出 JSON：`sections[{title, paragraphs[]}]`。"
  
- **测试方式**：
```bash
# cURL 测试
curl -X POST http://localhost:8000/materials/immersive \
  -H "Content-Type: application/json" \
  -d '{"chunkId": "chunk_123", "profileId": "demo_user"}' | jq .

# JSON Schema 校验
# Swagger UI 直接测试并查看响应格式
```

### 3) 章节测验
- **接口设计**：
  - `POST /materials/quiz`：生成测验题
  - 请求：`{ chunkId, profileId, count: 10 }`
  - 响应：`{ questions: [{id, type, stem, options[], answer, explanation, difficulty}] }`
  
- **提示词**：
  - "生成 8-12 道题，类型覆盖多选/判断/简答；提供 `answer` 与 `explanation`；题目紧贴本章概念。"
  
- **测试方式**：
```bash
# 生成测验
curl -X POST http://localhost:8000/materials/quiz \
  -H "Content-Type: application/json" \
  -d '{"chunkId": "chunk_123", "profileId": "demo_user", "count": 10}' | jq .

# 验证点：
# - JSON Schema 校验
# - 干扰项多样性与难度分布
# - 答案格式正确性
```

### 4) 思维导图
- **接口设计**：
  - `POST /materials/mindmap`：生成思维导图
  - 请求：`{ chunkId, profileId }`
  - 响应：`{ nodes: [{id, label, type}], edges: [{source, target, label}] }`
  
- **提示词**：
  - "输出 `nodes[]` 与 `edges[]` 的 JSON，节点含 `id,label,type`，边含 `source,target,label`。"
  
- **测试方式**：
```bash
# 生成思维导图
curl -X POST http://localhost:8000/materials/mindmap \
  -H "Content-Type: application/json" \
  -d '{"chunkId": "chunk_123", "profileId": "demo_user"}' | jq .

# 验证点：
# - 拓扑连通性（无孤立节点）
# - 关键概念覆盖
# - 可用 graphviz/cytoscape.js 验证可视化效果
```

## 验收
- 三种素材均可稳定生成，JSON 格式符合 Schema；
- API 响应时间 < 5s（普通章节），< 15s（复杂章节）；
- Pydantic 模型校验通过率 100%；
- 提供完整的 Postman Collection 演示三种素材生成；
- 可选：提供简单的 HTML 页面渲染演示效果。

